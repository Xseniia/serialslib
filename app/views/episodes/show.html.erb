<div class="serial-container">
  <h4>Season <%= @episode.season.season_number %></h4>
  <h2>Episode <%= @episode.episode_number %>. <%= @episode.title %></h2>
  <p>Release date: <%= @episode.release_date %></p>
  <br>

  <h4>What people think of this episode?</h4>

  <br>

  <% if Comment.where(episode_id: @episode.id).empty? %>
    <p>No comments.</p>
  <% else %>
    <% Comment.where(episode_id: @episode.id, comment_id: nil).each do |comment| %>
      <div class="card card-body">
          <div class="card-user-info">
            <div class="comment-user-email">
              <h5 class="card-title"><%= User.where(id: comment.user_id).first.email %></h5>
            </div>
            <div class="comment-button">
              <% if current_user&.admin %>
                <%= link_to 'Delete comment', episode_comment_path(@episode, comment), method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-light"  %>
              <% end %>
            </div>
          </div>
          <p class="card-text"><%= comment.content %></p>
          <p>
            <%= comment.created_at.strftime("%F") %> <%= comment.created_at.strftime("%T") %>
          </p>
          <% Comment.where(episode_id: @episode.id, comment_id: comment.id).each do |reply| %>
            <div class="card card-body">
              <div class="card-user-info">
                <div class="comment-user-email">
                  <h5 class="card-title"><%= User.where(id: reply.user_id).first.email %></h5>
                </div>
                <div class="comment-button">
                  <% if current_user&.admin %>
                    <%= link_to 'Delete comment', episode_comment_path(@episode, reply), method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-light"  %>
                  <% end %>
                </div>
              </div>
              <p class="card-text"><%= reply.content %></p>
              <p>
                <%= reply.created_at.strftime("%F") %> <%= reply.created_at.strftime("%T") %>
              </p>
            </div>
          <% end %>
          <div class="card reply-card">
            <%= render "episodes/comments/form", comment_id: comment.id %>
          </div>
      </div>
    <% end %>
  <% end %>

  <br>

  <% if current_user %>
    <h4>Add a comment</h4>
    <%= render partial: "episodes/comments/form"  %>
  <% else %>
    <p class="comments-disabled">Only authorised users can add comments.</p>
    <br>
  <% end %>

</div>

<br>

<%= link_to 'Back', serial_season_path(@episode.season.serial.id, @episode.season.id), class: "btn btn-light" %>
